<script>
    async function fetchPartInfo() {
        const partInput = document.getElementById('partNumber');
        const partNumber = partInput.value.trim();
        const resultDiv = document.getElementById('result');
        
        if (!partNumber) {
            resultDiv.innerHTML = '<div class="error">Please enter a part number</div>';
            partInput.focus();
            return;
        }
        
        // Use the part number exactly as entered by the user
        const partUrl = `https://www.detroitaxle.com/${encodeURIComponent(partNumber)}`;
        
        // Show loading state
        resultDiv.innerHTML = '<div style="text-align: center;"><div class="loading"></div><p>Searching for part...</p></div>';
        
        try {
            // Using a proxy to avoid CORS issues
            const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent(partUrl);
            const response = await fetch(proxyUrl);
            const data = await response.json();
            
            if (data.status.http_code !== 200) {
                throw new Error('Part not found');
            }
            
            // Parse the HTML content
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(data.contents, 'text/html');
            
            // Extract part information
            const partName = htmlDoc.querySelector('h1.productView-title')?.textContent?.trim() || 'Part not found';
            const price = htmlDoc.querySelector('div.price-section span.price.price--withoutTax')?.textContent?.trim() || 'Price not available';
            const description = htmlDoc.querySelector('div.productView-description')?.textContent?.trim() || 'No description available';
            const imageUrl = htmlDoc.querySelector('img.productView-image--default')?.src || '';
            
            // Display results
            resultDiv.innerHTML = `
                <div class="part-info">
                    <dt>Part Number:</dt>
                    <dd>${partNumber}</dd>
                    
                    <dt>Part Name:</dt>
                    <dd>${partName}</dd>
                    
                    <dt>Description:</dt>
                    <dd>${description}</dd>
                </div>
                
                <div class="price">Price: ${price}</div>
                
                ${imageUrl ? `<img src="${imageUrl}" alt="${partName}" style="max-width: 100%; border-radius: 8px; margin-bottom: 1rem;">` : ''}
                
                <a href="${partUrl}" class="view-button" target="_blank">View on Detroit Axle</a>
            `;
            
        } catch (error) {
            resultDiv.innerHTML = `
                <div class="error">Error: Could not find part "${partNumber}"</div>
                <p>Try searching on the <a href="${partUrl}" target="_blank" style="color: var(--primary);">Detroit Axle website</a></p>
            `;
        }
        
        // Reset for next search
        partInput.focus();
    }

    // Handle Enter key press
    document.getElementById('partNumber').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            fetchPartInfo();
        }
    });
</script>
